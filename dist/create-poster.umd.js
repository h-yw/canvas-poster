var w=Object.defineProperty;var T=(l,o,t)=>o in l?w(l,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[o]=t;var x=(l,o,t)=>(T(l,typeof o!="symbol"?o+"":o,t),t);(function(l,o){typeof exports=="object"&&typeof module!="undefined"?module.exports=o():typeof define=="function"&&define.amd?define(o):(l=typeof globalThis!="undefined"?globalThis:l||self,l["create-poster"]=o())})(this,function(){"use strict";class l{constructor(t,e){x(this,"_canvas");x(this,"_ctx");x(this,"_config");this._canvas=t,this._config=e,this._ctx=this._canvas.getContext("2d"),this._setCanvas()}_setCanvas(){this._config&&(this._canvas.width=this._config.width,this._canvas.height=this._config.height),this._ctx.font="24px sans-serif",this._ctx.fillStyle="#000",this._ctx.textAlign="center",this._ctx.textBaseline="middle"}async draw(t){let e=t.length;for(let n=0;n<e;n++)if(t[n].type==="text"&&(this.drawText(t[n]),console.log(n)),t[n].type==="image"&&(t[n].image instanceof Image&&(this.drawImage(t[n]),console.log(n)),typeof t[n].image=="string")){let c=await this.createImage(t[n].image);t[n].image=c,this.drawImage(t[n]),console.log(n)}}async drawText(t){return new Promise((e,n)=>{if(t.font&&(this._ctx.font=t.font),t.color&&(this._ctx.fillStyle=t.color),t.textAlign&&(this._ctx.textAlign=t.textAlign),!t.maxWidth){this._ctx.fillText(t.text,t.x,t.y);return}let c=t.maxWidth||200,i=t.totalLine||1,g=t.lineHeight||24,v=t.x||0,I=t.y||0,_=t.text.split(""),s=[],f=[];for(let h=0;h<_.length;h++){const r=_[h];f.push(r);const u=f.join("");if(this._ctx.measureText(u).width>c){f.pop(),s.push(f.join("")),f=[r];continue}h===_.length-1&&s.push(u)}let d=s.length>i?i:s.length;for(let h=0;h<d;h++)h+1===d&&d!==1&&(s[h]=s[h]+"..."),this._ctx.fillText(s[h],v,I+h*g);e(s.length)})}async drawImage(t){return new Promise((e,n)=>{t.borderRadius!==void 0&&this.creatBorderRect(t.x,t.y,t.width,t.height,t.borderRadius),t.dx==null||t.dy==null||t.dWidth==null||t.dHeight==null?this._ctx.drawImage(t.image,t.x,t.y,t.width,t.height):this._ctx.drawImage(t.image,t.dx,t.dy,t.dWidth,t.dHeight,t.x,t.y,t.width,t.height),this.restore()})}createImage(t){if(!Image){console.log("\u4E0D\u652F\u6301new Image(),\u4F20\u5165CanvasImageSource");return}let e=new Image;return e.src=t,e.referrerPolicy="no-referrer",new Promise((c,i)=>{e.onload=function(){c(e)},e.onerror=function(g){i(g)}})}creatBorderRect(t,e,n,c,i,g){this._ctx.beginPath(),this._ctx.arc(t+i,e+i,i,Math.PI,1.5*Math.PI),this._ctx.moveTo(t+i,e),this._ctx.lineTo(t+n-i,e),this._ctx.lineTo(t+n,e+i),this._ctx.arc(t+n-i,e+i,i,1.5*Math.PI,2*Math.PI),this._ctx.lineTo(t+n,e+c-i),this._ctx.lineTo(t+n-i,e+c),this._ctx.arc(t+n-i,e+c-i,i,0,.5*Math.PI),this._ctx.lineTo(t+i,e+c),this._ctx.lineTo(t,e+c-i),this._ctx.arc(t+i,e+c-i,i,.5*Math.PI,Math.PI),this._ctx.lineTo(t,e+i),this._ctx.lineTo(t+i,e),this._ctx.fillStyle=g||"#5a5a5a",this._ctx.fill(),this._ctx.closePath(),this._ctx.save(),this._ctx.clip()}restore(){this._ctx.restore()}canvas2Image(t,e){return this._canvas.toDataURL("image/png",1)}getCanvas(){return this._canvas}getCtx(){return this._ctx}}return l});
//# sourceMappingURL=create-poster.umd.js.map
